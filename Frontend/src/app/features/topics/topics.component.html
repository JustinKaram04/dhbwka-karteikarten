<div class="themengebiete" (click)="closeMenu()">
  <app-header></app-header>

  <main class="topics">
    <h2>Themenbereiche:</h2>

<div class="search-filter-container">
  <div class="filter-group">
    <label for="search">ğŸ” Suche:</label>
    <input
      id="search"
      type="text"
      [value]="searchQuery"
      (input)="updateSearchQuery($event)"
      placeholder="Themengebiet suchenâ€¦"
    />
  </div>
  <div class="filter-group">
    <label for="sortOption">ğŸ“Œ Sortieren nach:</label>
    <select
      id="sortOption"
      [value]="sortCriteria"
      (change)="updateSortCriteria($event)"
    >
      <option value="name-asc">Name (A â†’ Z)</option>
      <option value="name-desc">Name (Z â†’ A)</option>
      <option value="id-asc">ID (â†‘)</option>
      <option value="id-desc">ID (â†“)</option>
    </select>
  </div>
</div>


    <div class="topic-container">
      <app-add-item
        [labelName]="'Themengebiet'"
        [placeholderName]="'Name eingebenâ€¦'"
        [labelDescription]="'Beschreibung'"
        [placeholderDescription]="'Beschreibung eingebenâ€¦'"
        [buttonText]="'HinzufÃ¼gen'"
        [cancelText]="'Abbrechen'"
        (add)="addTopicHandler($event)"
      ></app-add-item>

      <!-- Nur rendern, wenn Topics geladen -->
      <ng-container *ngIf="filteredTopics$ | async as topics">
        <ng-container
          *ngFor="let topic of topics | searchSort: searchQuery : sortCriteria : ['name','id']"
        >
          <app-editable-card
            class="topic-card"
            [editing]="editingTopicId === topic.id"
            [showMenu]="activeMenuId === topic.id"
            (toggleMenu)="toggleMenu(topic.id, $event)"
            (cardClick)="navigateToTopic(topic.id, $event)"
          >
            <span
              progressDot
              class="progress-dot"
              [ngClass]="{
                'dot-red': topic.progress === 'low',
                'dot-yellow': topic.progress === 'medium',
                'dot-green': topic.progress === 'high'
              }"
            ></span>

            <div cardView>
              <h2>{{ topic.name }}</h2>
              <p>{{ topic.description }}</p>
            </div>

            <div cardEdit>
              <input
                [(ngModel)]="editedTopicName"
                placeholder="Neuer Nameâ€¦"
              />
              <textarea
                [(ngModel)]="editedTopicDescription"
                placeholder="Neue Beschreibungâ€¦"
              ></textarea>
              <div class="button-group">
                <button (click)="saveTopic()">ğŸ’¾ Speichern</button>
                <button class="cancel-btn" (click)="cancelEditing()">âŒ Abbrechen</button>
              </div>
            </div>

            <div cardMenu class="menu" (click)="$event.stopPropagation()">
              <button (click)="startEditing(topic, $event)">âœï¸ Bearbeiten</button>
              <button (click)="deleteTopic(topic.id, $event)">ğŸ—‘ï¸ LÃ¶schen</button>
            </div>
          </app-editable-card>
        </ng-container>
      </ng-container>
    </div>
  </main>
</div>