<div class="unterthemen-page" (click)="closeMenu()">
  <app-header></app-header>
  <div class="unterthemen-content">
    <button class="back-button" (click)="goBack()">⬅ zurück</button>
    <h1>{{ themengebietName }}</h1>
    <h2>unterthemen:</h2>

    <!-- such- und sort-bereich -->
    <div class="search-filter-container">
      <div class="filter-group">
        <label for="search">🔍 suche:</label>
        <input id="search" type="text" [(ngModel)]="searchQuery" placeholder="unterthema suchen…" />
      </div>
      <div class="filter-group">
        <label for="sortOption">📌 sortieren nach:</label>
        <select id="sortOption" [(ngModel)]="sortCriteria" (change)="updateSortOption($event)">
          <option value="id-asc">id (aufsteigend)</option>
          <option value="id-desc">id (absteigend)</option>
          <option value="name-asc">alphabetisch (a → z)</option>
          <option value="name-desc">alphabetisch (z → a)</option>
        </select>
      </div>
    </div>

    <!-- grid mit add-komponente + allen unterthemen -->
    <div class="unterthemen-grid">
      <app-add-item
        [labelName]="'unterthema'"
        [placeholderName]="'name eingeben…'"
        [labelDescription]="'beschreibung'"
        [placeholderDescription]="'beschreibung eingeben…'"
        [buttonText]="'hinzufügen'"
        [cancelText]="'abbrechen'"
        (add)="addSubtopicHandler($event)"
      ></app-add-item>

      <ng-container *ngFor="let sub of unterthemen$ | async | searchSort:searchQuery:sortCriteria:['id','name']">
        <app-editable-card
          class="unterthemen-card"
          [editing]="editingSubtopicId === sub.id"
          [showMenu]="activeMenuId === sub.id"
          (toggleMenu)="toggleMenu(sub.id, $event)"
          (cardClick)="navigateToUnterthema(sub.id, $event)"
        >
          <!-- normalansicht -->
          <div cardView>
            <h3>{{ sub.name }}</h3>
            <p>{{ sub.description }}</p>
          </div>

          <!-- editansicht -->
          <div cardEdit>
            <label for="editName">neuer name:</label>
            <input id="editName" type="text" [(ngModel)]="editedSubtopicName" placeholder="neuer name…" />
            <label for="editDesc">neue beschreibung:</label>
            <textarea id="editDesc" [(ngModel)]="editedSubtopicDescription" placeholder="beschreibung…"></textarea>
            <div class="button-group">
              <button (click)="saveSubtopic()">💾 speichern</button>
              <button class="cancel-btn" (click)="cancelEditing()">❌ abbrechen</button>
            </div>
          </div>

          <!-- kontext-menü -->
          <div cardMenu class="menu" (click)="$event.stopPropagation()">
            <button (click)="startEditing(sub, $event)">✏️ bearbeiten</button>
            <button class="delete-btn" (click)="loeschen(sub.id, $event)">🗑️ löschen</button>
          </div>
        </app-editable-card>
      </ng-container>
    </div>
  </div>
</div>
